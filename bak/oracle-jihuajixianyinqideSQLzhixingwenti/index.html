<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/logo.svg"><title>oracle-计划基线引起的SQL执行问题 | 散客</title><meta name="description" content="thank">
    <link rel="preload" href="/assets/style-ChPBveyY.css" as="style"><link rel="stylesheet" href="/assets/style-ChPBveyY.css">
    <link rel="modulepreload" href="/assets/app-CiE264yX.js"><link rel="modulepreload" href="/assets/index.html-HDO2sPOQ.js">
    <link rel="prefetch" href="/assets/timeline.html-C0Lk3g0A.js" as="script"><link rel="prefetch" href="/assets/posts.html-yyBEX37_.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-D66nxIB8.js" as="script"><link rel="prefetch" href="/assets/1.html-DskLOxTX.js" as="script"><link rel="prefetch" href="/assets/1.html-CCcRRHr4.js" as="script"><link rel="prefetch" href="/assets/1.html-Cc7u0iSb.js" as="script"><link rel="prefetch" href="/assets/1.html-DMNgt208.js" as="script"><link rel="prefetch" href="/assets/1.html-BvJGlzPc.js" as="script"><link rel="prefetch" href="/assets/1.html-CYaDT32i.js" as="script"><link rel="prefetch" href="/assets/1.html-naniLBH5.js" as="script"><link rel="prefetch" href="/assets/1.html-xvZ_Fz7U.js" as="script"><link rel="prefetch" href="/assets/index.html-Bbo2klxZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CalH6I_v.js" as="script"><link rel="prefetch" href="/assets/index.html-CVhgHSP0.js" as="script"><link rel="prefetch" href="/assets/index.html-DyWUrzRK.js" as="script"><link rel="prefetch" href="/assets/index.html-Day46LFZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DNfQYyvL.js" as="script"><link rel="prefetch" href="/assets/1.html-DswhFIJG.js" as="script"><link rel="prefetch" href="/assets/0.html-Bv0ycOOD.js" as="script"><link rel="prefetch" href="/assets/3.html-96XX2Qiy.js" as="script"><link rel="prefetch" href="/assets/2.html-CMS8oz4E.js" as="script"><link rel="prefetch" href="/assets/404.html-DnU8LKYT.js" as="script"><link rel="prefetch" href="/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/logo.svg" alt="散客"><a href="/" class="site-name can-hide">散客</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="首页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->首页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/huanshijiemozukaifa/1.html" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/Mod/1.html" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/timeline.html" class="link" aria-label="时间线"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->时间线<!--]--></span></span><!--[--><!--]--></a></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">oracle-计划基线引起的SQL执行问题</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->renxian<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2026/07/16<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/categories/oracle/1.html" class="">oracle</a><a href="/categories/sql/1.html" class="">sql</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/tags/oracle/1.html" class="">oracle</a><a href="/tags/sql/1.html" class="">sql</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><p>前段时间发现一个查询很慢的业务，经常要执行十几二十几分钟，甚至有医院反馈有时候转一两个小时都没查出来，但是有时候又很快，几秒钟就能查出来，影响到院内销售数据的上传了。</p><p>于是偶尔抽点时间对其研究了一下，总算是得出结果了，这里记录一下排查过程。</p><p>SQL的大致逻辑为对门诊和住院的药品消耗信息进行查询，关联了病人信息、追溯码等信息，对门诊和住院的不同业务采用了不同的查询，最后将结果使用UNION ALL合并，涉及的表有十几张，SQL有两百多行。大致SQL结构如下：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">SELECT</span>
<span class="line">    ...(表字段、子查询等)</span>
<span class="line">FROM</span>
<span class="line">    ...(七到八张表，包括临时表)</span>
<span class="line">WHERE</span>
<span class="line">    ...(内连表、时间范围、机构等条件)</span>
<span class="line">UNION ALL</span>
<span class="line">SELECT</span>
<span class="line">    ...(表字段、子查询等)</span>
<span class="line">FROM</span>
<span class="line">    ...(七到八张表，包括临时表)</span>
<span class="line">WHERE</span>
<span class="line">    ...(内连表、时间范围、机构等条件)</span>
<span class="line">UNION ALL</span>
<span class="line">SELECT</span>
<span class="line">    ...(表字段、子查询等)</span>
<span class="line">FROM</span>
<span class="line">    ...(七到八张表，包括临时表)</span>
<span class="line">WHERE</span>
<span class="line">    ...(内连表、时间范围、机构等条件)</span>
<span class="line">UNION ALL</span>
<span class="line">SELECT</span>
<span class="line">    ...(表字段、子查询等)</span>
<span class="line">FROM</span>
<span class="line">    ...(七到八张表，包括临时表)</span>
<span class="line">WHERE</span>
<span class="line">    ...(内连表、时间范围、机构等条件)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-sql测试" tabindex="-1"><a class="header-anchor" href="#_1-sql测试"><span>1. SQL测试</span></a></h2><p>使用跟踪工具拿到SQL后先是进行简单的测试，使用sqlplus和其他数据库连接工具测试，结果如下：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">SQL&gt; SET TIMING ON;</span>
<span class="line">SQL&gt; SELECT count(0) FROM (...);</span>
<span class="line"></span>
<span class="line">  COUNT(0)</span>
<span class="line">----------</span>
<span class="line">      6008</span>
<span class="line"></span>
<span class="line">已用时间:  00: 00: 00.36</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>便草率地认为SQL没啥问题（最后发现确实也没啥问题），开始转向排查应用服务的问题。</p><h2 id="_2-应用服务排查" tabindex="-1"><a class="header-anchor" href="#_2-应用服务排查"><span>2. 应用服务排查</span></a></h2><p>因为是医保项目，涉及的业务众多，可能会有连接数不够的情况，所以先检查了数据源配置。配置中心的配置如下：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOwAAABACAYAAAAZDZuBAAADTElEQVR4Xu3dQW7dMAxF0ayxs66hS+8gS2hhpCyY9ylacizbVO4BjJCi7O9Geekwb3+Axb3/ftelst50AVgNgQUKIbBAIQQWKITAAoUQWKAQAgsUQmCBQpYO7I+fv3TpPz/L9l3pKe+x54nfu+9iRmC3M7RLHZ31eAls5ok/dE95jz1V3nNFZwdWzzLLRe+s10tg9SH+t0H04X7uReu994zMtDetz9Je13WvpzPdrzPtbU2/muweHHd2YJWem9c765UGVuu9vqfWPqq1H5mZ6LO0j2rtrY7Won6kbj2ntY5jvmVgtR+ZGV3P7jk6M7q+13vR80f3q9ae6Pn6DO0xZmZg9WyyPpv1IrCu95fOVGt/tHfT2mO1rumF4wis1NrrzOh6ds/RmdH1rO+ZRWtRrzPT2tPzfHzNrMBG56Rr2blq3+NLgdW+p9Y+qrUfmRldz3qttfdfo1r7kfpIjzEzAts6E10fOfceaWCt95df93MVrffeMzKL3knr3t6/n/9q9PnZvmwtminbH80w5uzA+rOJzqi1vjfrsRvYM818NtBydmDv9CmwswM1+/lAZNnAAisisEAhBBYohMAChRBYoBACCxRCYIFCCCxQCIEFCiGwQCEEFiiEwAKFEFigkKUCu/1juLi4alz8D4vlbT/oqyCwWB6BBQohsEAhBBYohMAChRBYoBACCxRCYIFCCCxQCIEFCiGwQCEEFiiEwAKFEFigkKUDm/2FOT/L9l3pjPfofUa274nfG3yYEVj/d16vPO+XwGae+EN55Xtkn/XE7w0+zArsHV4Cqy/if4NEP5St3zDReu89IzPtTeuztLc1rff2We/3+3XP9uk6rnF2YO88xzSwWu/1PbX2Ua39yMxEn6V9q9a+p9Y+qqMe880IrL+u1B1Y7UdmRteze47OjK5nfavWvlVr36qjHvPNCGzWz0Rgk1r7Vq291nrhWmcHVl15pgQ2qbVv1dq3atyDwP6rte+ptY9q7UdmRtezvlVr36q1b9VRj/nODqyeofYzpYG13l9+3c9VtN57z8gseiet9/pWrX00i94r24frnR3YzV1nuhvYM818NtAyI7B3+RTY2YGa/XwgsmxggRURWKAQAgsUQmCBQlYK7F9+DbmItnCoagAAAABJRU5ErkJggg==" alt="数据库连接配置.png"></p><p>于是选择了没有业务量的测试集群进行测试，并dump了应用的堆栈情况，查看连接池的情况以及线程卡在了哪里。</p><p>使用如下命令dump堆：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">jmap <span class="token parameter variable">-dump:format</span><span class="token operator">=</span>b,file<span class="token operator">=</span>/root/dump.hprof <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将得到的文件拖入idea中分析，可以看到实际的连接数保持着最小连接数，同时也没有出现内存不足的情况。</p><p><img src="/assets/%E5%AE%9E%E9%99%85%E8%BF%9E%E6%8E%A5%E6%95%B0%E9%87%8F-Ccl9N9I7.png" alt="实际连接数量.png"></p><p>连接池没有问题那么就查看线程卡在了哪里，使用如下命令dump线程的执行情况：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">jstack <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> dump.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>得到的目标线程的调用栈信息如下：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&quot;http-nio-9102-exec-14&quot; #248 daemon prio=5 os_prio=0 tid=0x00007f2394006800 nid=0x205ea4 runnable [0x00007f23523eb000]</span>
<span class="line">   java.lang.Thread.State: RUNNABLE</span>
<span class="line">	at java.net.SocketInputStream.socketRead0(Native Method)</span>
<span class="line">	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)</span>
<span class="line">	at java.net.SocketInputStream.read(SocketInputStream.java:171)</span>
<span class="line">	at java.net.SocketInputStream.read(SocketInputStream.java:141)</span>
<span class="line">	at oracle.net.ns.Packet.receive(Packet.java:311)</span>
<span class="line">	...</span>
<span class="line">	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)</span>
<span class="line">	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:139)</span>
<span class="line">	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:76)</span>
<span class="line">	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:59)</span>
<span class="line">	at com.sun.proxy.$Proxy802.getInsBillInfoD(Unknown Source)</span>
<span class="line">	at xxx.xxx.xxx.xxx.getInsBillInfo(xxx.java:1720)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到线程卡在了SocketInputStream的socketRead0方法上，说明在等待数据库返回数据，那么问题其实还是出在SQL上。</p><h2 id="_3-sql执行问题分析" tabindex="-1"><a class="header-anchor" href="#_3-sql执行问题分析"><span>3. SQL执行问题分析</span></a></h2><p>通过查询SQL执行记录拿到真正的SQL，可以使用如下语句查询执行记录，SQL_FULLTEXT就是真正的SQL语句了。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> s<span class="token punctuation">.</span>SID<span class="token punctuation">,</span></span>
<span class="line">       s<span class="token punctuation">.</span><span class="token keyword">SERIAL</span><span class="token comment">#,</span></span>
<span class="line">       sa<span class="token punctuation">.</span>SQL_ID<span class="token punctuation">,</span></span>
<span class="line">       sa<span class="token punctuation">.</span>SQL_FULLTEXT<span class="token punctuation">,</span></span>
<span class="line">       sl<span class="token punctuation">.</span>CHILD_NUMBER<span class="token punctuation">,</span></span>
<span class="line">       sa<span class="token punctuation">.</span>LAST_ACTIVE_TIME<span class="token punctuation">,</span></span>
<span class="line">       s<span class="token punctuation">.</span><span class="token keyword">STATUS</span></span>
<span class="line"><span class="token keyword">FROM</span> v$<span class="token keyword">sql</span> sl</span>
<span class="line">         <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> v$sqlarea sa <span class="token keyword">ON</span> sl<span class="token punctuation">.</span>SQL_ID <span class="token operator">=</span> sa<span class="token punctuation">.</span>SQL_ID</span>
<span class="line">         <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> v$<span class="token keyword">session</span> s <span class="token keyword">ON</span> sa<span class="token punctuation">.</span>hash_value <span class="token operator">=</span> s<span class="token punctuation">.</span>sql_hash_value</span>
<span class="line"><span class="token keyword">WHERE</span> INSTR<span class="token punctuation">(</span>sa<span class="token punctuation">.</span>SQL_FULLTEXT<span class="token punctuation">,</span> <span class="token string">&#39;v$sqlarea&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">  <span class="token operator">AND</span> INSTR<span class="token punctuation">(</span>sa<span class="token punctuation">.</span>SQL_FULLTEXT<span class="token punctuation">,</span> ${<span class="token keyword">SQL</span>}<span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> <span class="token number">0</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sa<span class="token punctuation">.</span>LAST_ACTIVE_TIME <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于项目中使用了分页插件，可以看到真正执行的SQL大致长下面这个样子（这里做了简化），并且其中包含了绑定变量。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> TMP_PAGE<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> ROWNUM ROW_ID</span>
<span class="line"><span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> field1<span class="token punctuation">,</span> field2 <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> field1 <span class="token operator">=</span> :<span class="token number">1</span> <span class="token operator">AND</span> field <span class="token operator">=</span> :<span class="token number">2</span><span class="token punctuation">)</span> TMP_PAGE</span>
<span class="line"><span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以通过如下语句拿到SQL绑定的变量</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> position<span class="token punctuation">,</span> datatype_string<span class="token punctuation">,</span> value_string</span>
<span class="line"><span class="token keyword">FROM</span> v$sql_bind_capture</span>
<span class="line"><span class="token keyword">WHERE</span> sql_id <span class="token operator">=</span> ${SQL_ID}</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> position<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后使用nodejs采用绑定变量的方式执行SQL，果然很慢，成功复现问题。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> oradb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../oradb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">SELECT TMP_PAGE.*, ROWNUM ROW_ID</span>
<span class="line">FROM (SELECT field1, field2 FROM t WHERE field1 = :1 AND field = :2) TMP_PAGE</span>
<span class="line">WHERE ROWNUM &lt;= 50</span>
<span class="line"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">[</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">oradb<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>多次尝试后发现SQL第一次执行很慢（600~800s），后续执行就很快了(&lt;1s)，应该是数据库将对应的数据加载到了共享池中，所以后续查询变快了。</p><p>猜测变量窥探的问题，于是在SQL加上/*+ BIND WARE */，成功改善第一次执行很慢的问题，每次的执行时间几乎保持一致，与未使用绑定变量的情况下相同。</p><p>但是后在后续的测试中发现去掉/*+ BIND WARE */，稍微修改SQL也能达到同样的效果，比如：count(0)改成count(1) ，调整字段顺序，甚至加注释等，SQL执行时间都能大幅度降低。</p><p>于是使用EXPLAIN PLAN FOR查看使用绑定变量的SQL的执行计划，并与未使用绑定变量的SQL的执行计划进行对比。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">--分析SQL执行计划</span></span>
<span class="line"><span class="token keyword">EXPLAIN</span> <span class="token keyword">PLAN</span> <span class="token keyword">FOR</span></span>
<span class="line"><span class="token keyword">SELECT</span> TMP_PAGE<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> ROWNUM ROW_ID</span>
<span class="line"><span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> field1<span class="token punctuation">,</span> field2 <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> field1 <span class="token operator">=</span> :<span class="token number">1</span> <span class="token operator">AND</span> field <span class="token operator">=</span> :<span class="token number">2</span><span class="token punctuation">)</span> TMP_PAGE</span>
<span class="line"><span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">50</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">--查看执行计划</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span><span class="token punctuation">(</span>DBMS_XPLAN<span class="token punctuation">.</span>DISPLAY<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到使用绑定变量的SQL执行计划中，使用了计划基线，而未使用绑定变量的SQL执行计划则是自适应计划。</p><p>使用绑定变量的SQL执行计划：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&quot;Note&quot;</span>
<span class="line">&quot;-----&quot;</span>
<span class="line">&quot;   - SQL plan baseline SQL_PLAN_06dtmvj5wkaxufd6c22ed used for this statement&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>未使用绑定变量的SQL执行计划：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&quot;Note&quot;</span>
<span class="line">&quot;-----&quot;</span>
<span class="line">&quot;   - this is an adaptive plan&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过SQL执行记录拿到执行计划：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> <span class="token keyword">TABLE</span><span class="token punctuation">(</span>DBMS_XPLAN<span class="token punctuation">.</span>DISPLAY_CURSOR<span class="token punctuation">(</span>${SQL_ID}<span class="token punctuation">,</span> ${CHILD_NUMBER}<span class="token punctuation">,</span> <span class="token string">&#39;ALLSTATS LAST&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>果然如此，该SQL使用了计划基线，导致每次执行都使用相同的执行计划，这个计划基线应该是前期数据量少或者数据有倾斜时产生的，已经过时了。</p><h2 id="_4-解决方案" tabindex="-1"><a class="header-anchor" href="#_4-解决方案"><span>4. 解决方案</span></a></h2><p>最终通过删除SQL计划基线来解决了该问题。</p><p>可以通过以下语句查询SQL计划基线：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> dba_sql_plan_baselines</span>
<span class="line"><span class="token keyword">WHERE</span> INSTR<span class="token punctuation">(</span>SQL_TEXT<span class="token punctuation">,</span> ${<span class="token keyword">SQL</span>}<span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> <span class="token number">0</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> LAST_VERIFIED <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span><span class="token operator">*</span> </span>
<span class="line"><span class="token keyword">FROM</span> dba_sql_plan_baselines b<span class="token punctuation">,</span> v$<span class="token keyword">sql</span> s</span>
<span class="line"><span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>signature <span class="token operator">=</span> DBMS_SQLTUNE<span class="token punctuation">.</span>SQLTEXT_TO_SIGNATURE<span class="token punctuation">(</span>s<span class="token punctuation">.</span>sql_fulltext<span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">AND</span> s<span class="token punctuation">.</span>sql_id <span class="token operator">=</span> ${SQL_ID}<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除SQL计划基线：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">  DBMS_SPM<span class="token punctuation">.</span>DROP_SQL_PLAN_BASELINE<span class="token punctuation">(</span>sql_handle <span class="token operator">=</span><span class="token operator">&gt;</span> ${SQL_HANDLE}<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终测试结果显示，删除SQL计划基线后，SQL执行时间恢复正常。</p><h2 id="_5-疑问" tabindex="-1"><a class="header-anchor" href="#_5-疑问"><span>5. 疑问</span></a></h2><p>其实对比快慢两个SQL的执行计划，发现两者的执行计划差异并不大，慢的SQL执行计划中仅在每一个多层NESTED LOOPS外多了一个FILTER，且条件始终为真。但是在内层循环有条件限制的情况下，最后进行FILTER数据量也不大，因此我感觉目前执行过程的并不是主要因素。</p><p>由于拿不到服务器的密码，也就拿不到跟踪文件，还不敢完全下定论慢是由执行计划的引起的。因为还有一个现象就是使用EXPLAIN PLAN FOR分析执行计划时也很慢(300~500s)，还需进一步探究。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&quot;----------------------------------------------------------------------------------------------------------------------&quot;</span>
<span class="line">&quot;| Id  | Operation                                             | Name             | E-Rows |  OMem |  1Mem | Used-Mem |&quot;</span>
<span class="line">&quot;----------------------------------------------------------------------------------------------------------------------&quot;</span>
<span class="line">&quot;|   0 | SELECT STATEMENT                                      |                  |        |       |       |          |&quot;</span>
<span class="line">&quot;|*  1 |  COUNT STOPKEY                                        |                  |        |       |       |          |&quot;</span>
<span class="line">&quot;|   2 |   VIEW                                                |                  |      4 |       |       |          |&quot;</span>
<span class="line">&quot;|   3 |    UNION-ALL                                          |                  |        |       |       |          |&quot;</span>
<span class="line">&quot;|   4 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_9          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*  5 |      INDEX UNIQUE SCAN                                | PK_TABLE_9       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|   6 |     TABLE ACCESS BY INDEX ROWID BATCHED               | TABLE_10         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*  7 |      INDEX RANGE SCAN                                 | IDX$$_51450002   |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|   8 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_11         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*  9 |      INDEX UNIQUE SCAN                                | PK_TABLE_11      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  10 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_11         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 11 |      INDEX UNIQUE SCAN                                | PK_TABLE_11      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  12 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_12         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 13 |      INDEX UNIQUE SCAN                                | PK_TABLE_12      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  14 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_13         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 15 |      INDEX UNIQUE SCAN                                | TABLE_13_PK      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 16 |     FILTER                                            |                  |        |       |       |          |&quot;</span>
<span class="line">&quot;|  17 |      NESTED LOOPS                                     |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  18 |       NESTED LOOPS                                    |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  19 |        NESTED LOOPS                                   |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  20 |         NESTED LOOPS                                  |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  21 |          NESTED LOOPS                                 |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  22 |           NESTED LOOPS                                |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  23 |            NESTED LOOPS                               |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  24 |             NESTED LOOPS                              |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 25 |              TABLE ACCESS BY INDEX ROWID BATCHED      | TABLE_1          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 26 |               INDEX RANGE SCAN                        | IDXSF$$_51420008 |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 27 |              TABLE ACCESS BY INDEX ROWID              | TABLE_2          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 28 |               INDEX UNIQUE SCAN                       | PK_TABLE_2       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  29 |             TABLE ACCESS BY INDEX ROWID               | TABLE_3          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 30 |              INDEX UNIQUE SCAN                        | PK_TABLE_3       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 31 |            TABLE ACCESS BY INDEX ROWID                | TABLE_4          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 32 |             INDEX UNIQUE SCAN                         | PK_TABLE_4       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  33 |           TABLE ACCESS BY INDEX ROWID                 | TABLE_5          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 34 |            INDEX UNIQUE SCAN                          | PK_TABLE_5       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  35 |          PARTITION RANGE ITERATOR                     |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  36 |           TABLE ACCESS BY LOCAL INDEX ROWID           | TABLE_6          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 37 |            INDEX UNIQUE SCAN                          | PK_TABLE_6       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 38 |         INDEX UNIQUE SCAN                             | PK_TABLE_7       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  39 |        PARTITION RANGE ITERATOR                       |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|* 40 |         INDEX UNIQUE SCAN                             | PK_TABLE_8       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|  41 |       TABLE ACCESS BY LOCAL INDEX ROWID               | TABLE_8          |      1 |       |       |          |&quot;</span>
<span class="line">...</span>
<span class="line">&quot;| 117 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_9          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*118 |      INDEX UNIQUE SCAN                                | PK_TABLE_9       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 119 |     TABLE ACCESS BY INDEX ROWID BATCHED               | TABLE_10         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*120 |      INDEX RANGE SCAN                                 | IDX$$_51450002   |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 121 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_11         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*122 |      INDEX UNIQUE SCAN                                | PK_TABLE_11      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 123 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_11         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*124 |      INDEX UNIQUE SCAN                                | PK_TABLE_11      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 125 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_12         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*126 |      INDEX UNIQUE SCAN                                | PK_TABLE_12      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 127 |     TABLE ACCESS BY INDEX ROWID                       | TABLE_13         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*128 |      INDEX UNIQUE SCAN                                | TABLE_13_PK      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*129 |     FILTER                                            |                  |        |       |       |          |&quot;</span>
<span class="line">&quot;| 130 |      NESTED LOOPS                                     |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 131 |       NESTED LOOPS                                    |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 132 |        NESTED LOOPS                                   |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 133 |         NESTED LOOPS                                  |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*134 |          HASH JOIN                                    |                  |      1 |   787K|   787K|  230K (0)|&quot;</span>
<span class="line">&quot;|*135 |           HASH JOIN                                   |                  |      1 |   935K|   935K| 1297K (0)|&quot;</span>
<span class="line">&quot;|*136 |            HASH JOIN                                  |                  |      1 |  1335K|  1335K| 1680K (0)|&quot;</span>
<span class="line">&quot;| 137 |             TABLE ACCESS BY INDEX ROWID BATCHED       | TABLE_2          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*138 |              INDEX RANGE SCAN                         | IDXSF$$_51420005 |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 139 |             TABLE ACCESS BY GLOBAL INDEX ROWID BATCHED| TABLE_14         |      2 |       |       |          |&quot;</span>
<span class="line">&quot;|*140 |              INDEX RANGE SCAN                         | IDX$$_51440009   |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*141 |            TABLE ACCESS FULL                          | TABLE_4          |    113 |       |       |          |&quot;</span>
<span class="line">&quot;|*142 |           TABLE ACCESS BY INDEX ROWID                 | TABLE_1          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*143 |            INDEX RANGE SCAN                           | IDXSF$$_51420008 |      3 |       |       |          |&quot;</span>
<span class="line">&quot;| 144 |          TABLE ACCESS BY INDEX ROWID                  | TABLE_5          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*145 |           INDEX UNIQUE SCAN                           | PK_TABLE_5       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 146 |         PARTITION RANGE ITERATOR                      |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 147 |          TABLE ACCESS BY LOCAL INDEX ROWID            | TABLE_15         |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*148 |           INDEX UNIQUE SCAN                           | PK_TABLE_15      |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 149 |        PARTITION RANGE ITERATOR                       |                  |      1 |       |       |          |&quot;</span>
<span class="line">&quot;|*150 |         INDEX UNIQUE SCAN                             | PK_TABLE_8       |      1 |       |       |          |&quot;</span>
<span class="line">&quot;| 151 |       TABLE ACCESS BY LOCAL INDEX ROWID               | TABLE_8          |      1 |       |       |          |&quot;</span>
<span class="line">&quot;----------------------------------------------------------------------------------------------------------------------&quot;</span>
<span class="line"></span>
<span class="line">&quot;  16 - filter(:2&gt;=:1)&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><footer class="page-meta"><!----><!----></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/bak/oracle-jihuajixianyinqideSQLzhixingwenti/#_1-sql测试" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. SQL测试"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. SQL测试<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/bak/oracle-jihuajixianyinqideSQLzhixingwenti/#_2-应用服务排查" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 应用服务排查"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 应用服务排查<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/bak/oracle-jihuajixianyinqideSQLzhixingwenti/#_3-sql执行问题分析" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3. SQL执行问题分析"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3. SQL执行问题分析<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/bak/oracle-jihuajixianyinqideSQLzhixingwenti/#_4-解决方案" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4. 解决方案"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4. 解决方案<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/bak/oracle-jihuajixianyinqideSQLzhixingwenti/#_5-疑问" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5. 疑问"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5. 疑问<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CiE264yX.js" defer></script>
  </body>
</html>
